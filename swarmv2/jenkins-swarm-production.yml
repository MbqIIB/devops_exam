version: '3.1'

services:

  main:
    image: vfarcic/jenkins-swarm-agent
    environment:
      - COMMAND_OPTIONS=-master http://${JENKINS_IP}:8080 -username ${MASTER_USER:-admin} -password ${MASTER_PASS:-admin} -labels 'production' -executors 5
    volumes:
      - jm:/var/jenkins_home 
      - jmshare:/usr/share/jenkins/ref
    deploy:
      placement:
        constraints: [node.role == manager] 

volumes:
  jm:
    external: true
  jmshare:
    external: true
